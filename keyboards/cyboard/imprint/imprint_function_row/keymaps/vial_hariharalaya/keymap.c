/* Copyright 2023 Cyboard LLC (@Cyboard-DigitalTailor)
 * SPDX-License-Identifier: GPL-2.0-or-later
 */

#include QMK_KEYBOARD_H
//#include "features/achordion.h"

enum custom_keycodes {
    C_AREP2 = SAFE_RANGE,
    MG_EFORE,
    MG_ON,
    MG_UST,
    MG_ENT,
    MG_ION,
    MG_MENT,
    MG_ER,
    MG_HICH,
    MG_ES,   
    MG_THE,   
    MG_UI
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

    [0] = LAYOUT_fun(
        KC_ESC,  KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,                               KC_F6,   KC_F7,   KC_F8,  KC_F9,  KC_F10,  KC_F11,
        KC_EQL,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                                KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    KC_MINS,
        KC_TAB,  KC_Q,    KC_W,    KC_E,    KC_R,    KC_T,                                KC_Y,    KC_U,    KC_I,    KC_O,    KC_P,    KC_BSLS,
        KC_LCTL, KC_A,    KC_S,    KC_D,    KC_F,    KC_G,                                KC_H,    KC_J,    KC_K,    KC_L,    KC_SCLN, KC_QUOT,
        KC_LSFT, KC_Z,    KC_X,    KC_C,    KC_V,    KC_B,                                KC_N,    KC_M,    KC_COMM, KC_DOT,  KC_SLSH, KC_RSFT,
                          KC_LGUI,   KC_LALT,   KC_LGUI, KC_ENT, KC_DEL,           KC_BSPC,  KC_SPC,  MO(1), KC_LBRC,  KC_RBRC,
                                            KC_HOME, KC_END,    KC_ESC,           KC_GRAVE,  KC_CAPS,  KC_APP
    ),

    [1] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, KC_HOME, KC_UP,   KC_END,  _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, KC_LEFT, KC_DOWN, KC_RIGHT, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [2] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [3] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [4] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [5] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [6] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [7] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [8] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, _______, _______, _______,         _______, _______, _______, _______, _______,
                                            _______, _______, _______,         _______, _______, _______
    ),

    [9] = LAYOUT_fun(
        _______, _______, _______, _______, _______, _______,                           _______, QK_AREP, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        _______, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
        CW_TOGG, _______, _______, _______, _______, _______,                           _______, _______, _______, _______, _______, _______,
                          _______, _______, QK_REP, _______, _______,         _______, _______, _______, _______, _______,
                                            C_AREP2, _______, _______,         _______, _______, _______
    )
};

/*
void matrix_scan_user(void) {
    achordion_task();
}
*/

bool remember_last_key_user(uint16_t keycode, keyrecord_t* record,
                            uint8_t* remembered_mods) {
    switch (keycode) {
        case C_AREP2:
            return false;  // Ignore ALTREP keys.
    }

    return true;  // Other keys can be repeated.
}

static void process_c_arep2(uint16_t keycode, uint8_t mods) {
    //bool shifted = (mods & MOD_MASK_SHIFT);
    switch (keycode) {
        case KC_B: tap_code(KC_N); break; 
        case KC_N: tap_code(KC_F); break; 
        case KC_H: tap_code(KC_N); break; 

    }
}

uint16_t get_alt_repeat_key_keycode_user(uint16_t keycode, uint8_t mods) {
    switch (keycode) {
        case KC_A: return KC_O;  
        case KC_B: return MG_EFORE;
        case KC_C: return KC_Y;  
        case KC_D: return KC_Y;  
        case KC_E: return KC_U;
        case KC_F: return KC_NO;
        case KC_G: return KC_Y;  
        case KC_H: return KC_NO;
        case KC_I: return MG_ON;  
        case KC_J: return MG_UST;  
        case KC_K: return KC_S;  
        case KC_L: return KC_R;  
        case KC_M: return MG_ENT;  
        case KC_N: return MG_ION;  
        case KC_O: return KC_A;  
        case KC_P: return KC_Y;  

        case KC_Q: return MG_UI;
        case KC_R: return KC_L;  
        case KC_S: return KC_L;  
        case KC_T: return MG_MENT;  
        case KC_U: return KC_E;  
        case KC_V: return MG_ER;  
        case KC_W: return MG_HICH;  
        case KC_X: return MG_ES;  
        case KC_Y: return KC_P;  
        case KC_Z: return KC_NO;
        //case KC_COMM: return KC_Y;  
        //case KC_DOT: return KC_Y;  
        
    }

    return MG_THE;
}

bool process_record_user(uint16_t keycode, keyrecord_t* record) {
//   if (!process_achordion(keycode, record)) { return false; }

    switch (keycode) {
        case C_AREP2: 
            if (record->event.pressed) {
                process_c_arep2(get_last_keycode(), get_last_mods());
            }
           return false; 

        case MG_EFORE:
            if (record->event.pressed) {
                SEND_STRING("efore"); break;
            }
        return false;
        case MG_ON: 
            if (record->event.pressed) {
                SEND_STRING("on"); break;
            }
        return false;
        case MG_UST: 
            if (record->event.pressed) {
                SEND_STRING("ust"); break;
            }
        return false;
        case MG_ENT: 
            if (record->event.pressed) {
                SEND_STRING("ent"); break;
            }
        return false;
        case MG_ION: 
            if (record->event.pressed) {
                SEND_STRING("ion"); break;
            }
        return false;
        case MG_MENT: 
            if (record->event.pressed) {
                SEND_STRING("ment"); break;
            }
        return false;
        case MG_ER: 
            if (record->event.pressed) {
                SEND_STRING("er"); break;
            }
        return false;
        case MG_HICH: 
            if (record->event.pressed) {
                SEND_STRING("hich"); break;
            }
        return false;
        case MG_ES: 
            if (record->event.pressed) {
                SEND_STRING("es"); break;
            }
        case MG_UI: 
            if (record->event.pressed) {
                SEND_STRING("ui"); break;
            }
        return false;
        case MG_THE:
            if (record->event.pressed) {
                SEND_STRING("the"); break;
            }
        return false;   
    }
    return true;
}
